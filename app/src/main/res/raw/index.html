<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8">
        <meta
                name="viewport"
                content="width=device-width, initial-scale=1.0">
        <title>æ˜Ÿè¼ç›´æ’­</title>
        <style>
            body {
                height: 100vh;
                margin: 0;
                padding: 1rem;
                background-color: #263238;
                color: #EEEEEE;
            }

            a {
                color: #EEEEEE;
            }

            hr {
                margin-top: .5rem;
                margin-bottom: .5rem;
            }

            label {
                display: inline-block;
                width: 100%;
                margin-bottom: .5rem;
            }

            input[type="file"] {
                color: #EEEEEE;
                cursor: pointer;
            }

            input, textarea {
                color: #1a1a1a;
                padding: .6rem;
                border: none;
                border-radius: 4px;
                transition: box-shadow 0.3s ease-in-out;
                vertical-align: bottom;
            }

            input:focus, textarea:focus {
                outline: none;
                border-color: #66afe9;
                box-shadow: 0 0 10px rgba(102, 175, 233, 0.6);
            }

            .container {
                display: flex;
                flex-direction: row;
            }

            input[type="text"], input[type="number"] {
                flex: 1;
                box-sizing: border-box;
            }

            input[type="text"], input[type="number"], input[type="file"], input[type="button"] {
                height: 2.6rem;
            }

            input[type="button"] {
                margin-left: .6rem;
                cursor: pointer;
            }

            /* åç§°è¾“å…¥æ¡†æ ·å¼ */
            #uri-name {
                flex: 0 0 30%;
                margin-right: 0.5rem;
            }

            #uri {
                flex: 1;
            }

            #confirm-uri {
                flex: 0 0 4rem;
                margin-left: 0.5rem;
            }

            .source-grey {
                background-color: grey;
                color: #EEEEEE;
            }

            .source-green {
                background-color: darkslategray;
                color: #EEEEEE;
            }

            .history {
                margin-top: 10px;
            }

            .history > input[type="text"] {
                color: #EEEEEE;
                border: none;
            }

            .history-name {
                flex: 0 0 25%;
                margin-right: 0.5rem;
                background-color: grey;
            }

            .history-uri {
                flex: 0 0 35%;
                margin-right: 0.5rem;
                background-color: grey;
            }

            .history-ua {
                flex: 0 0 20%;
                margin-right: 0.5rem;
                background-color: grey;
                color: #EEEEEE;
                text-align: center;
                font-size: 0.8rem;
            }

            .history-referrer {
                flex: 0 0 20%;
                margin-right: 0.5rem;
                background-color: grey;
                color: #EEEEEE;
                text-align: center;
                font-size: 0.8rem;
            }

            .message-box {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 10px 20px;
                background-color: #333;
                color: #fff;
                border-radius: 5px;
                opacity: 0;
                transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
                transform: translateX(100%);
            }

            .message-box.show {
                opacity: 1;
                transform: translateX(0);
            }
        </style>
        <base target="_blank">
    </head>
    <body>
        <h1 class="title">æ˜Ÿè¼ç›´æ’­</h1>
        <h4>è¦–é »æºå¯ä»¥è®¾ç½®ç‚ºåœ°å€/æ–‡ä»¶å…¶ä¸­ä¹‹ä¸€</h4>
        <h4>è¦–é »æºæ–‡æœ¬è½‰æ›ï¼š<a target="_blank" href="https://lizongying.github.io/js-gua64/">å…­åå››å¦ç·¨ç¢¼</a></h4>
        <hr/>

        <div class="item">
            <label for="uri-name" id="uri-label">è¦–é »æºåœ°å€</label>
            <div class="input-grid">
                <input type="text" id="uri-name" placeholder="ğŸ“º åç§°ï¼ˆå¦‚ï¼šå®‰å¾½ç§»åŠ¨å•æ’­ï¼‰" class="input-field input-name"/>
                <input type="text" id="uri" placeholder="ğŸ”— è§†é¢‘æºåœ°å€ https://..." class="input-field input-uri"/>
                <input type="text" id="uri-ua" placeholder="ğŸŒ User-Agent (å¯é€‰)" class="input-field input-ua"/>
                <input type="text" id="uri-referrer" placeholder="ğŸ”’ Referer é˜²ç›—é“¾ (å¯é€‰)" class="input-field input-referrer"/>
                <input type="button" id="confirm-uri" value="â• æ–°å¢" class="btn-add"/>
            </div>

            <style>
                /* å“åº”å¼ç½‘æ ¼å¸ƒå±€ */
                .input-grid {
                    display: grid;
                    gap: 0.6rem;
                    width: 100%;
                }

                /* åŸºç¡€è¾“å…¥æ¡†æ ·å¼ */
                .input-field {
                    height: 2.8rem;
                    border-radius: 8px;
                    border: 1px solid #455A64;
                    background: #37474F;
                    color: #fff;
                    padding: 0 1rem;
                    font-size: 0.9rem;
                    width: 100%;
                    box-sizing: border-box;
                    transition: all 0.2s;
                }

                .input-field:focus {
                    outline: none;
                    border-color: #009688;
                    box-shadow: 0 0 0 3px rgba(0, 150, 136, 0.1);
                }

                .input-field::placeholder {
                    color: #90A4AE;
                }

                /* æ–°å¢æŒ‰é’®æ ·å¼ */
                .btn-add {
                    height: 2.8rem;
                    border-radius: 8px;
                    border: none;
                    background: linear-gradient(135deg, #009688 0%, #00796B 100%);
                    color: #fff;
                    font-weight: 600;
                    cursor: pointer;
                    font-size: 0.9rem;
                    box-shadow: 0 2px 8px rgba(0, 150, 136, 0.3);
                    transition: all 0.2s;
                    width: 100%;
                }

                .btn-add:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 4px 12px rgba(0, 150, 136, 0.4);
                }

                .btn-add:active {
                    transform: translateY(0);
                }

                /* PCç«¯å¸ƒå±€ (>=768px) - ä¸¤è¡Œ */
                @media (min-width: 768px) {
                    .input-grid {
                        grid-template-columns: 1fr 2fr 1fr 1.5fr 80px;
                        grid-template-rows: auto auto;
                    }

                    .input-name {
                        grid-column: 1;
                        grid-row: 1;
                    }

                    .input-uri {
                        grid-column: 2 / 4;
                        grid-row: 1;
                    }

                    .input-ua {
                        grid-column: 1;
                        grid-row: 2;
                    }

                    .input-referrer {
                        grid-column: 2 / 4;
                        grid-row: 2;
                    }

                    .btn-add {
                        grid-column: 4 / 6;
                        grid-row: 2;
                        width: auto;
                    }
                }

                /* å¹³æ¿ç«¯ (480px-767px) - ç®€åŒ–ä¸¤è¡Œ */
                @media (min-width: 480px) and (max-width: 767px) {
                    .input-grid {
                        grid-template-columns: 1fr 1fr;
                        grid-template-rows: auto auto auto;
                    }

                    .input-name { grid-column: 1; grid-row: 1; }
                    .input-uri { grid-column: 2; grid-row: 1; }
                    .input-ua { grid-column: 1; grid-row: 2; }
                    .input-referrer { grid-column: 2; grid-row: 2; }
                    .btn-add {
                        grid-column: 1 / 3;
                        grid-row: 3;
                        width: 100%;
                    }
                }

                /* æ‰‹æœºç«¯ (<480px) - å‚ç›´å †å  */
                @media (max-width: 479px) {
                    .input-grid {
                        grid-template-columns: 1fr;
                        gap: 0.5rem;
                    }

                    .input-field, .btn-add {
                        width: 100%;
                    }

                    .input-field {
                        height: 2.6rem;
                        font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
                    }

                    .btn-add {
                        height: 2.6rem;
                        margin-top: 0.3rem;
                    }
                }
            </style>
            <div id="sources-new"></div>
            <div id="source"></div>
        </div>

        <hr/>

        <div class="item">
            <label for="upload-file" id="upload-file-label">è¦–é »æºæ–‡ä»¶ï¼Œé¸æ“‡å¾Œæœƒè‡ªå‹•ä¸Šå‚³ä¿å­˜</label>
            <div class="container">
                <input type="file" id="upload-file" multiple/>
            </div>
        </div>

        <hr/>

        <div class="item">
            <label for="channel" id="channel-label">é»˜èªæ’­æ”¾é »é“è™Ÿï¼Œå¾1é–‹å§‹ã€‚0ä»£è¡¨é»˜èªè¨­ç½®</label>
            <div class="container">
                <input type="number" id="channel" min="0" max="99"/>
                <input type="button" id="confirm-channel" value="ç¢ºèª" class="confirm"/>
            </div>
        </div>

        <hr/>

        <div class="item">
            <label for="epg" id="epg-label">EPG</label>
            <div class="container">
                <input type="text" id="epg"/>
                <input type="button" id="confirm-epg" value="ç¢ºèª" class="confirm"/>
            </div>
        </div>

        <hr/>

        <div class="item">
            <label for="proxy" id="proxy-label">ä»£ç†åœ°å€</label>
            <div class="container">
                <input type="text" id="proxy"/>
                <input type="button" id="confirm-proxy" value="ç¢ºèª" placeholder="http://0.0.0.0:0" class="confirm"/>
            </div>
        </div>

        <hr/>

        <div id="messageBox" class="message-box"></div>

        <div style="height: 100%"></div>
    </body>
    <script>
        const lang = {
            TRADITIONAL_CHINESE: {
                appName: 'æ˜Ÿè¼ç›´æ’­',
                description: 'è¦–é »æºå¯ä»¥è®¾ç½®ç‚ºåœ°å€/æ–‡ä»¶å…¶ä¸­ä¹‹ä¸€',
                uriLabel: 'è¦–é »æºåœ°å€',
                uploadFileLabel: 'è¦–é »æºæ–‡ä»¶ï¼Œé¸æ“‡å¾Œæœƒè‡ªå‹•ä¸Šå‚³ä¿å­˜',
                channelLabel: 'é»˜èªæ’­æ”¾é »é“ï¼Œå¾1é–‹å§‹ã€‚0ä»£è¡¨é»˜è®¤è¨­ç½®',
                epgLabel: 'EPG',
                proxyLabel: 'ä»£ç†åœ°å€',
                confirm: 'ç¢ºèª',
                remove: 'åˆªé™¤',
                add: 'æ–°å¢',
                uaPlaceholder: 'User-Agent (å¯é¸)',
            },
            SIMPLIFIED_CHINESE: {
                appName: 'æ˜Ÿè¾‰ç›´æ’­',
                description: 'è§†é¢‘æºå¯ä»¥è®¾ç½®ä¸ºåœ°å€/æ–‡ä»¶å…¶ä¸­ä¹‹ä¸€',
                uriLabel: 'è§†é¢‘æºåœ°å€',
                uploadFileLabel: 'è§†é¢‘æºæ–‡ä»¶ï¼Œé€‰æ‹©åä¼šè‡ªåŠ¨ä¸Šä¼ ä¿å­˜',
                channelLabel: 'é»˜è®¤æ’­æ”¾é¢‘é“ï¼Œä»1å¼€å§‹ã€‚0ä»£è¡¨é»˜èªè®¾ç½®',
                epgLabel: 'EPG',
                proxyLabel: 'ä»£ç†åœ°å€',
                confirm: 'ç¡®è®¤',
                remove: 'åˆ é™¤',
                add: 'æ–°å¢',
                uaPlaceholder: 'User-Agent (å¯é€‰)',
            }
        };
        const t = (key) => lang['TRADITIONAL_CHINESE'][key];
        document.querySelector('h1').innerText = t('appName');
        document.querySelector('h4').innerText = t('description');
        document.querySelector('#uri-label').innerText = t('uriLabel');
        document.querySelector('#upload-file-label').innerText = t('uploadFileLabel');
        document.querySelector('#channel-label').innerText = t('channelLabel');
        document.querySelector('#epg-label').innerText = t('epgLabel');
        document.querySelector('#proxy-label').innerText = t('proxyLabel');
        document.querySelectorAll('.confirm').forEach(
            i => i.value = t('confirm')
        );
        document.querySelectorAll('.add').forEach(
            i => i.value = t('add')
        );

        const source = document.querySelector('#source');

        const uploadFile = document.querySelector('#upload-file');

        uploadFile.onchange = function (e) {
            handleFiles(e.target.files)
        }

        const handleFiles = async function (files) {
            for (let i = 0; i < files.length; i++) {
                await read(files[i]);
            }
        }

        const read = async (file) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                save('/api/import-text', e.target.result);
            };
            reader.readAsText(file);
        }

        ['#uri', '#uri-name', '#channel', '#epg', '#proxy'].forEach(e => {
            const ele = document.querySelector(e);
            ele.addEventListener('focus', () => {
                ele.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            });
        })

        document.querySelector('#confirm-uri').onclick = () => {
            let uri = document.querySelector('#uri').value.trim();
            let name = document.querySelector('#uri-name').value.trim();
            let ua = document.querySelector('#uri-ua').value.trim();
            let referrer = document.querySelector('#uri-referrer').value.trim();

            // å¼ºåˆ¶è¦æ±‚å¡«å†™åç§°
            if (!name) {
                alert('è«‹è¼¸å…¥è¦–é »æºåç¨±');
                document.querySelector('#uri-name').focus();
                return;
            }

            if (!uri) {
                alert('è«‹è¼¸å…¥è¦–é »æºåœ°å€');
                return;
            }
            if (!uri.startsWith('http')) {
                uri = 'http://' + uri;
            }
            if (!isValidUrl(uri)) {
                alert(`ç„¡æ•ˆçš„åœ°å€${uri}`);
                return;
            }

            console.log('Adding source:', { name, uri, ua, referrer });

            const uuid = uuidV4()
            save('/api/import-uri', JSON.stringify({
                id: uuid,
                uri: uri,
                name: name,
                ua: ua,
                referrer: referrer
            }))
            showMessage('å·²ç¢ºèª', 3000);

            // ä¿®æ”¹ï¼šå†å²è®°å½•æ˜¾ç¤ºUAå’ŒReferrerçŠ¶æ€
            let uaText = ua ? (ua.length > 8 ? ua.substring(0, 8) + '...' : ua) : 'æ— UA';
            let refText = referrer ? (referrer.length > 8 ? referrer.substring(0, 8) + '...' : referrer) : 'æ— Ref';

            let htmlString = `<div class="container history">
                <input type="text" readonly value="${name}" class="history-name" title="${uri}"/>
                <input type="text" readonly value="â—â—â—â—â—â—â—â—â—â—" class="history-uri" title="${uri}"/>
                <input type="text" readonly value="${uaText}" class="history-ua" title="UA: ${ua || 'æ— '}"/>
                <input type="text" readonly value="${refText}" class="history-referrer" title="Referrer: ${referrer || 'æ— '}"/>
                <input type="button" value="${t('remove')}" class="remove" data-source-id="${uuid}" data-uri="${uri}" data-name="${name}" data-ua="${ua}" data-referrer="${referrer}"/>
            </div>`;

            let doc = new DOMParser().parseFromString(htmlString, 'text/html');
            const firstChild = source.firstChild;
            if (firstChild) {
                source.insertBefore(doc.body.firstChild, firstChild);
            } else {
                source.appendChild(doc.body.firstChild);
            }

            // æ¸…ç©ºè¾“å…¥æ¡†
            document.querySelector('#uri-name').value = '';
            document.querySelector('#uri').value = '';
            document.querySelector('#uri-ua').value = '';
            document.querySelector('#uri-referrer').value = '';

            handleRemove()
        }

        document.querySelector('#confirm-channel').onclick = () => {
            const channel = document.querySelector('#channel').value.trim();
            if (channel.length > 0) {
                save('/api/default-channel', JSON.stringify({
                    channel: channel
                }))
                showMessage('å·²ç¢ºèª', 3000);
            } else {
                alert(`å…§å®¹ç‚ºç©º`);
            }
        }

        document.querySelector('#confirm-epg').onclick = () => {
            const epg = document.querySelector('#epg').value.trim();
            save('/api/epg', JSON.stringify({
                epg: epg
            }))
            showMessage('å·²ç¢ºèª', 3000);
        }

        document.querySelector('#confirm-proxy').onclick = () => {
            let proxy = document.querySelector('#proxy').value.trim();
            if (proxy && (!proxy.startsWith('http') && !proxy.startsWith('socks'))) {
                proxy = 'http://' + proxy;
            }
            if (proxy && (!proxy.startsWith('http') && !proxy.startsWith('socks'))) {
                alert(`ç„¡æ•ˆçš„åœ°å€${proxy}`);
                return;
            }
            if (proxy && !isValidUrl(proxy)) {
                alert(`ç„¡æ•ˆçš„åœ°å€${proxy}`);
                return;
            }
            document.querySelector('#proxy').value = proxy;
            save('/api/proxy', JSON.stringify({
                proxy: proxy
            }))
            showMessage('å·²ç¢ºèª', 3000);
        }

        const save = async (url, body) => {
            console.log('Sending to', url, ':', body);

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: body
                });

                const text = await response.text();
                console.log('Response:', response.status, text);
                return text;
            } catch (e) {
                console.error('Fetch error:', e);
                throw e;
            }
        }

        const handleRemove = () => {
            const removes = document.querySelectorAll('.remove');
            [...removes].forEach(remove => {
                remove.onclick = () => {
                    const sourceId = remove.dataset.sourceId.trim();
                    console.log('sourceId', sourceId);
                    save('/api/remove-source', JSON.stringify({
                        sourceId: sourceId
                    }))
                    remove.parentElement.remove()
                }
            })
        }

        const handleAdd = () => {
            const addList = document.querySelectorAll('.new-source');
            [...addList].forEach(add => {
                add.value = t('add');
                add.onclick = () => {
                    const uri = add.dataset.uri.trim();
                    const name = add.dataset.name.trim();
                    const ua = add.dataset.ua || '';
                    const referrer = add.dataset.referrer || '';

                    console.log('Adding from list:', { name, uri, ua, referrer });

                    const uuid = uuidV4();
                    save('/api/import-uri', JSON.stringify({
                        id: uuid,
                        uri: uri,
                        name: name,
                        ua: ua,
                        referrer: referrer
                    }));

                    add.parentElement.remove();

                    // æ˜¾ç¤ºUAå’ŒReferrer
                    let uaText = ua ? (ua.length > 8 ? ua.substring(0, 8) + '...' : ua) : 'æ— UA';
                    let refText = referrer ? (referrer.length > 8 ? referrer.substring(0, 8) + '...' : referrer) : 'æ— Ref';

                    let htmlString = `<div class="container history">
                        <input type="text" readonly value="${name}" class="history-name" title="${uri}"/>
                        <input type="text" readonly value="â—â—â—â—â—â—â—â—â—â—" class="history-uri" title="${uri}"/>
                        <input type="text" readonly value="${uaText}" class="history-ua" title="UA: ${ua || 'æ— '}"/>
                        <input type="text" readonly value="${refText}" class="history-referrer" title="Referrer: ${referrer || 'æ— '}"/>
                        <input type="button" value="${t('remove')}" class="remove" data-source-id="${uuid}" data-uri="${uri}" data-name="${name}" data-ua="${ua}" data-referrer="${referrer}"/>
                    </div>`;

                    let doc = new DOMParser().parseFromString(htmlString, 'text/html');
                    const firstChild = source.firstChild;
                    if (firstChild) {
                        source.insertBefore(doc.body.firstChild, firstChild);
                    } else {
                        source.appendChild(doc.body.firstChild);
                    }

                    handleRemove();

                    document.querySelector('#uri').value = '';
                    document.querySelector('#uri-name').value = '';
                    document.querySelector('#uri-ua').value = '';
                    document.querySelector('#uri-referrer').value = '';
                }
            })
        }

        const uuidV4 = () => {
            return ([1e7] + '-' + 1e3 + '-' + 4e3 + '-' + 8e3 + '-' + 1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
            );
        }

        const isValidUrl = (url) => {
            try {
                new URL(url);
                return true;
            } catch (e) {
                return false;
            }
        }

        (async () => {
            const response = await fetch('/api/settings');
            const json = await response.json();
            console.log('Settings:', json);
            document.querySelector('#channel').value = json.channelDefault;
            document.querySelector('#uri').value = '';
            document.querySelector('#epg').value = json.epg;
            document.querySelector('#proxy').value = json.proxy;

            // ä¿®æ”¹ï¼šå†å²è®°å½•æ˜¾ç¤ºUAå’ŒReferrer
            json.history.forEach(v => {
                let name = v.name || 'æœªå‘½å';
                let ua = v.ua || '';
                let referrer = v.referrer || '';

                let uaText = ua ? (ua.length > 8 ? ua.substring(0, 8) + '...' : ua) : 'æ— UA';
                let refText = referrer ? (referrer.length > 8 ? referrer.substring(0, 8) + '...' : referrer) : 'æ— Ref';

                console.log('History item:', name, v.uri, 'ua:', ua, 'ref:', referrer);

                let htmlString = `<div class="container history">
                    <input type="text" readonly value="${name}" class="history-name" title="${v.uri}"/>
                    <input type="text" readonly value="â—â—â—â—â—â—â—â—â—â—" class="history-uri" title="${v.uri}"/>
                    <input type="text" readonly value="${uaText}" class="history-ua" title="UA: ${ua || 'æ— '}"/>
                    <input type="text" readonly value="${refText}" class="history-referrer" title="Referrer: ${referrer || 'æ— '}"/>
                    <input type="button" value="${t('remove')}" class="remove" data-source-id="${v.id}" data-uri="${v.uri}" data-name="${name}" data-ua="${ua}" data-referrer="${referrer}"/>
                </div>`;

                let doc = new DOMParser().parseFromString(htmlString, 'text/html');
                source.appendChild(doc.body.firstChild);
            })

            handleRemove()

            const sources = await fetch('/api/sources');
            const sourcesText = await sources.text();
            console.log('Raw sources text:', sourcesText);

            const histories = json.history.map(v => v.uri)
            const sourcesNew = document.querySelector('#sources-new');

            // æŒ‰è¡Œåˆ†å‰²ï¼Œä¿ç•™å®Œæ•´URL
            sourcesText.trim().split("\n").forEach((line) => {
                if (!line.trim()) return;

                console.log('Processing line:', line);

                let name, uri;
                const commaIndex = line.indexOf(',');

                if (commaIndex > 0) {
                    name = line.substring(0, commaIndex).trim();
                    uri = line.substring(commaIndex + 1).trim();
                    console.log('Parsed - Name:', name, 'URI:', uri);
                } else {
                    uri = line.trim();
                    const parts = uri.split('/');
                    name = parts[parts.length - 1]?.replace('.txt', '') || 'æœªå‘½å';
                    console.log('No comma - URI:', uri, 'Name:', name);
                }

                if (histories.includes(uri)) {
                    console.log('URI already in history, skipping:', uri);
                    return;
                }

                // é¢„å®šä¹‰åˆ—è¡¨ä¹Ÿæ˜¾ç¤ºUA/Referrerå ä½
                let htmlString = `<div class="container history">
                    <input type="text" readonly value="${name}" class="history-name" style="background-color: darkslategray;" title="${uri}"/>
                    <input type="text" readonly value="â—â—â—â—â—â—â—â—â—â—" class="history-uri" style="background-color: darkslategray;" title="${uri}"/>
                    <input type="text" readonly value="æ— UA" class="history-ua" style="background-color: darkslategray;" title="ç‚¹å‡»æ·»åŠ æ—¶å¯è®¾ç½®UA"/>
                    <input type="text" readonly value="æ— Ref" class="history-referrer" style="background-color: darkslategray;" title="ç‚¹å‡»æ·»åŠ æ—¶å¯è®¾ç½®Referrer"/>
                    <input type="button" value="${t('add')}" class="add new-source" data-uri="${uri}" data-name="${name}" data-ua="" data-referrer=""/>
                </div>`;

                let doc = new DOMParser().parseFromString(htmlString, 'text/html');
                sourcesNew.appendChild(doc.body.firstChild);
            })

            handleAdd()
        })()

        const showMessage = (message, duration = 3000) => {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = message;
            messageBox.classList.add('show');

            setTimeout(() => {
                messageBox.classList.remove('show');
            }, duration);
        }
    </script>
</html>